<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HashMapæºç åˆ†æ - å±å±çš„åšå®¢</title>
  <meta name="description" content="{{post.excerpt}}">
  <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
  <div class="background-animation"></div>
  <div class="background-animation background-animation-2"></div>
  
  <header class="header">
    <div class="container">
      <nav class="nav">
        <a href="/" class="logo">å±å±çš„åšå®¢</a>
        <div class="nav-links">
          <a href="/" class="nav-link">é¦–é¡µ</a>
          <a href="/archives/" class="nav-link">å½’æ¡£</a>
        </div>
        <button class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
          <span class="theme-icon">ğŸŒ™</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <article class="post">
        <div class="post-header">
          <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
          <h1 class="post-title">HashMapæºç åˆ†æ</h1>
          <div class="post-meta">
            <span class="post-date">2026å¹´2æœˆ9æ—¥</span>
            
          </div>
        </div>
        
        <div class="post-content">
          <h1>HashMap æºç åˆ†æ</h1><h2>ä¸€ã€HashMap ç®€ä»‹</h2><p>HashMap æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„é›†åˆç±»ä¹‹ä¸€ï¼Œå®ƒåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œæä¾›äº†å¿«é€Ÿçš„é”®å€¼å¯¹å­˜å‚¨å’ŒæŸ¥æ‰¾åŠŸèƒ½ã€‚HashMap å…è®¸ä½¿ç”¨ null é”®å’Œ null å€¼ï¼Œå¹¶ä¸”ä¸ä¿è¯æ˜ å°„çš„é¡ºåºã€‚</p><h3>ä¸»è¦ç‰¹ç‚¹</h3><ul><ol><li>é”®å€¼å¯¹å­˜å‚¨ï¼ŒåŸºäºå“ˆå¸Œè¡¨å®ç°</li>
<li>å…è®¸ null é”®å’Œ null å€¼</li>
<li>éçº¿ç¨‹å®‰å…¨ï¼Œé€‚ç”¨äºå•çº¿ç¨‹ç¯å¢ƒ</li>
<li>é»˜è®¤åˆå§‹å®¹é‡ä¸º 16ï¼Œé»˜è®¤è´Ÿè½½å› å­ä¸º 0.75</li>
<li>æ‰©å®¹æ—¶å®¹é‡å˜ä¸ºåŸæ¥çš„ 2 å€</li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šå¹³å‡ O(1)ï¼Œæœ€å O(n)</li>
</ol></ul>
<h2>äºŒã€æ ¸å¿ƒæ•°æ®ç»“æ„</h2><h3>2.1 Node èŠ‚ç‚¹</h3><p>HashMap çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª Node å¯¹è±¡ï¼ŒNode æ˜¯ HashMap çš„é™æ€å†…éƒ¨ç±»ï¼š</p><p><pre class="language-java" data-lang="java"><code class="language-java">static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {
    final int hash;
    final K key;
    V value;
    Node&lt;K,V&gt; next;

    Node(int hash, K key, V value, Node&lt;K,V&gt; next) {
        this.hash = hash;
        this.key = key;
        this.value = value;
        this.next = next;
    }

    public final K getKey() { return key; }
    public final V getValue() { return value; }
    public final String toString() { return key + "=" + value; }

    public final int hashCode() {
        return Objects.hashCode(key) ^ Objects.hashCode(value);
    }

    public final V setValue(V newValue) {
        V oldValue = value;
        value = newValue;
        return oldValue;
    }

    public final boolean equals(Object o) {
        if (o == this)
            return true;
        if (o instanceof Map.Entry) {
            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;
            if (Objects.equals(key, e.getKey()) &amp;&amp;
                Objects.equals(value, e.getValue()))
                return true;
        }
        return false;
    }
}
</code></pre></p><h3>2.2 åº•å±‚ç»“æ„</h3><p>HashMap çš„åº•å±‚ç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼š</p><p><pre class="language-java" data-lang="java"><code class="language-java">public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt;
    implements Map&lt;K,V&gt;, Cloneable, Serializable {

    transient Node&lt;K,V&gt;[] table;  // å“ˆå¸Œæ¡¶æ•°ç»„

    transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;

    transient int size;  // å®é™…å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡

    transient int modCount;  // ç»“æ„æ€§ä¿®æ”¹æ¬¡æ•°

    final float loadFactor;  // è´Ÿè½½å› å­

    int threshold;  // æ‰©å®¹é˜ˆå€¼ = capacity * loadFactor
}
</code></pre></p><h2>ä¸‰ã€å…³é”®å‚æ•°</h2><h3>3.1 åˆå§‹å‚æ•°</h3><p><pre class="language-java" data-lang="java"><code class="language-java">static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4;  // é»˜è®¤åˆå§‹å®¹é‡ 16
static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;  // æœ€å¤§å®¹é‡
static final float DEFAULT_LOAD_FACTOR = 0.75f;  // é»˜è®¤è´Ÿè½½å› å­
static final int TREEIFY_THRESHOLD = 8;  // é“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼
static final int UNTREEIFY_THRESHOLD = 6;  // çº¢é»‘æ ‘è½¬é“¾è¡¨çš„é˜ˆå€¼
static final int MIN_TREEIFY_CAPACITY = 64;  // æ¡¶è½¬æ ‘çš„æœ€å°å®¹é‡
</code></pre></p><h3>3.2 æ„é€ æ–¹æ³•</h3><p><pre class="language-java" data-lang="java"><code class="language-java">public HashMap(int initialCapacity, float loadFactor) {
    if (initialCapacity &lt; 0)
        throw new IllegalArgumentException("Illegal initial capacity: " +
                                           initialCapacity);
    if (initialCapacity &gt; MAXIMUM_CAPACITY)
        initialCapacity = MAXIMUM_CAPACITY;
    if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))
        throw new IllegalArgumentException("Illegal load factor: " +
                                           loadFactor);
    this.loadFactor = loadFactor;
    this.threshold = tableSizeFor(initialCapacity);
}

public HashMap(int initialCapacity) {
    this(initialCapacity, DEFAULT_LOAD_FACTOR);
}

public HashMap() {
    this.loadFactor = DEFAULT_LOAD_FACTOR;
}
</code></pre></p><h3>3.3 tableSizeFor æ–¹æ³•</h3><p>è¿™ä¸ªæ–¹æ³•ç”¨äºå°†ç»™å®šçš„å®¹é‡è°ƒæ•´ä¸º 2 çš„ n æ¬¡å¹‚ï¼š</p><p><pre class="language-java" data-lang="java"><code class="language-java">static final int tableSizeFor(int cap) {
    int n = cap - 1;
    n |= n &gt;&gt;&gt; 1;
    n |= n &gt;&gt;&gt; 2;
    n |= n &gt;&gt;&gt; 4;
    n |= n &gt;&gt;&gt; 8;
    n |= n &gt;&gt;&gt; 16;
    return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
}
</code></pre></p><p>è¿™ä¸ªæ–¹æ³•é€šè¿‡ä¸€ç³»åˆ—çš„ä½è¿ç®—ï¼Œå°†æœ€é«˜ä½çš„ 1 åé¢çš„æ‰€æœ‰ä½éƒ½ç½®ä¸º 1ï¼Œç„¶ååŠ  1ï¼Œå¾—åˆ°ä¸€ä¸ª 2 çš„ n æ¬¡å¹‚ã€‚</p><h2>å››ã€Hash ç®—æ³•</h2><h3>4.1 hash æ–¹æ³•</h3><p>HashMap é€šè¿‡ hash æ–¹æ³•è®¡ç®— key çš„å“ˆå¸Œå€¼ï¼š</p><p><pre class="language-java" data-lang="java"><code class="language-java">static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);
}
</code></pre></p><p><strong>ä¸ºä»€ä¹ˆè¦è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Ÿ</strong></p><ul><ol><li><code>h >>> 16</code> å°†å“ˆå¸Œå€¼çš„é«˜ 16 ä½æ— ç¬¦å·å³ç§» 16 ä½</li>
<li><code>^</code> æ“ä½œå°†é«˜ 16 ä½å’Œä½ 16 ä½è¿›è¡Œå¼‚æˆ–</li>
<li>è¿™æ ·åšçš„å¥½å¤„æ˜¯è®©é«˜ä½çš„ç‰¹å¾ä¹Ÿèƒ½å‚ä¸åˆ°ä½ä½çš„è¿ç®—ä¸­ï¼Œå‡å°‘å“ˆå¸Œå†²çª</li>
</ol></ul>
<h3>4.2 ç´¢å¼•è®¡ç®—</h3><p>é€šè¿‡ hash å€¼è®¡ç®—åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®ï¼š</p><p><pre class="language-java" data-lang="java"><code class="language-java">index = (n - 1) &amp; hash
</code></pre></p><p>å…¶ä¸­ n æ˜¯æ•°ç»„é•¿åº¦ï¼Œå¿…é¡»æ˜¯ 2 çš„ n æ¬¡å¹‚ã€‚</p><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ä½è¿ç®—è€Œä¸æ˜¯å–æ¨¡ï¼Ÿ</strong></p><ul><ol><li>ä½è¿ç®—æ•ˆç‡æ›´é«˜</li>
<li>å½“ n æ˜¯ 2 çš„ n æ¬¡å¹‚æ—¶ï¼Œ<code>(n - 1) & hash</code> ç­‰ä»·äº <code>hash % n</code></li>
<li><code>(n - 1)</code> çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯å…¨ 1ï¼Œå¦‚ 16-1=15ï¼ŒäºŒè¿›åˆ¶ä¸º 1111</li>
</ol></ul>
<h2>äº”ã€put æ–¹æ³•æºç åˆ†æ</h2><h3>5.1 put æ–¹æ³•å…¥å£</h3><p><pre class="language-java" data-lang="java"><code class="language-java">public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}
</code></pre></p><h3>5.2 putVal æ–¹æ³•è¯¦è§£</h3><p><pre class="language-java" data-lang="java"><code class="language-java">final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
               boolean evict) {
    Node&lt;K,V&gt;[] tab;
    Node&lt;K,V&gt; p;
    int n, i;

    // 1. å¦‚æœ table ä¸ºç©ºæˆ–é•¿åº¦ä¸º 0ï¼Œè¿›è¡Œåˆå§‹åŒ–
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;

    // 2. è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå¦‚æœè¯¥ä½ç½®ä¸ºç©ºï¼Œç›´æ¥æ’å…¥æ–°èŠ‚ç‚¹
    if ((p = tab[i = (n - 1) &amp; hash]) == null)
        tab[i] = newNode(hash, key, value, null);
    else {
        Node&lt;K,V&gt; e;
        K k;

        // 3. åˆ¤æ–­è¯¥ä½ç½®çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸è¦æ’å…¥çš„ key ç›¸åŒ
        if (p.hash == hash &amp;&amp;
            ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))
            e = p;

        // 4. å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œè°ƒç”¨çº¢é»‘æ ‘çš„æ’å…¥æ–¹æ³•
        else if (p instanceof TreeNode)
            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);

        // 5. å¦åˆ™æ˜¯é“¾è¡¨ï¼Œéå†é“¾è¡¨
        else {
            for (int binCount = 0; ; ++binCount) {
                // åˆ°è¾¾é“¾è¡¨å°¾éƒ¨ï¼Œæ’å…¥æ–°èŠ‚ç‚¹
                if ((e = p.next) == null) {
                    p.next = newNode(hash, key, value, null);
                    // é“¾è¡¨é•¿åº¦è¾¾åˆ° 8ï¼Œè½¬ä¸ºçº¢é»‘æ ‘
                    if (binCount &gt;= TREEIFY_THRESHOLD - 1)
                        treeifyBin(tab, hash);
                    break;
                }

                // æ‰¾åˆ°ç›¸åŒçš„ key
                if (e.hash == hash &amp;&amp;
                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))
                    break;

                p = e;
            }
        }

        // 6. å¦‚æœæ‰¾åˆ°ç›¸åŒçš„ keyï¼Œè¦†ç›–æ—§å€¼
        if (e != null) {
            V oldValue = e.value;
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e);
            return oldValue;
        }
    }

    ++modCount;
    // 7. åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹
    if (++size &gt; threshold)
        resize();
    afterNodeInsertion(evict);
    return null;
}
</code></pre></p><h2>å…­ã€get æ–¹æ³•æºç åˆ†æ</h2><h3>6.1 get æ–¹æ³•å…¥å£</h3><p><pre class="language-java" data-lang="java"><code class="language-java">public V get(Object key) {
    Node&lt;K,V&gt; e;
    return (e = getNode(hash(key), key)) == null ? null : e.value;
}
</code></pre></p><h3>6.2 getNode æ–¹æ³•è¯¦è§£</h3><p><pre class="language-java" data-lang="java"><code class="language-java">final Node&lt;K,V&gt; getNode(int hash, Object key) {
    Node&lt;K,V&gt;[] tab;
    Node&lt;K,V&gt; first, e;
    int n;
    K k;

    // 1. æ£€æŸ¥ table æ˜¯å¦ä¸ºç©º
    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;
        (first = tab[(n - 1) &amp; hash]) != null) {

        // 2. æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åŒ¹é…
        if (first.hash == hash &amp;&amp;
            ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))
            return first;

        // 3. æ£€æŸ¥åç»­èŠ‚ç‚¹
        if ((e = first.next) != null) {
            // å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾
            if (first instanceof TreeNode)
                return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);

            // åœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾
            do {
                if (e.hash == hash &amp;&amp;
                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))
                    return e;
            } while ((e = e.next) != null);
        }
    }
    return null;
}
</code></pre></p><h2>ä¸ƒã€æ‰©å®¹æœºåˆ¶ï¼ˆresizeï¼‰</h2><h3>7.1 resize æ–¹æ³•è¯¦è§£</h3><p><pre class="language-java" data-lang="java"><code class="language-java">final Node&lt;K,V&gt;[] resize() {
    Node&lt;K,V&gt;[] oldTab = table;
    int oldCap = (oldTab == null) ? 0 : oldTab.length;
    int oldThr = threshold;
    int newCap, newThr = 0;

    // 1. è®¡ç®—æ–°å®¹é‡å’Œæ–°é˜ˆå€¼
    if (oldCap &gt; 0) {
        if (oldCap &gt;= MAXIMUM_CAPACITY) {
            threshold = Integer.MAX_VALUE;
            return oldTab;
        }
        else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;
                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr &lt;&lt; 1;
    }
    else if (oldThr &gt; 0)
        newCap = oldThr;
    else {
        newCap = DEFAULT_INITIAL_CAPACITY;
        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
    }

    if (newThr == 0) {
        float ft = (float)newCap * loadFactor;
        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY ?
                  (int)ft : Integer.MAX_VALUE);
    }
    threshold = newThr;

    // 2. åˆ›å»ºæ–°æ•°ç»„
    @SuppressWarnings({"rawtypes","unchecked"})
    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];
    table = newTab;

    // 3. è¿ç§»æ—§æ•°ç»„ä¸­çš„å…ƒç´ 
    if (oldTab != null) {
        for (int j = 0; j &lt; oldCap; ++j) {
            Node&lt;K,V&gt; e;
            if ((e = oldTab[j]) != null) {
                oldTab[j] = null;
                if (e.next == null)
                    newTab[e.hash &amp; (newCap - 1)] = e;
                else if (e instanceof TreeNode)
                    ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);
                else {
                    // é“¾è¡¨ä¼˜åŒ–ï¼šå°†é“¾è¡¨åˆ†ä¸ºåŸç´¢å¼•å’ŒåŸç´¢å¼•+oldCapä¸¤ä¸ªä½ç½®
                    Node&lt;K,V&gt; loHead = null, loTail = null;
                    Node&lt;K,V&gt; hiHead = null, hiTail = null;
                    Node&lt;K,V&gt; next;
                    do {
                        next = e.next;
                        if ((e.hash &amp; oldCap) == 0) {
                            if (loTail == null)
                                loHead = e;
                            else
                                loTail.next = e;
                            loTail = e;
                        }
                        else {
                            if (hiTail == null)
                                hiHead = e;
                            else
                                hiTail.next = e;
                            hiTail = e;
                        }
                    } while ((e = next) != null);

                    if (loTail != null) {
                        loTail.next = null;
                        newTab[j] = loHead;
                    }
                    if (hiTail != null) {
                        hiTail.next = null;
                        newTab[j + oldCap] = hiHead;
                    }
                }
            }
        }
    }
    return newTab;
}
</code></pre></p><h3>7.2 æ‰©å®¹ä¼˜åŒ–</h3><p>JDK 1.8 å¯¹æ‰©å®¹è¿›è¡Œäº†ä¼˜åŒ–ï¼š</p><ul><ol><li>ä½¿ç”¨ <code>(e.hash & oldCap)</code> åˆ¤æ–­å…ƒç´ æ˜¯åœ¨åŸä½ç½®è¿˜æ˜¯ç§»åŠ¨åˆ° <code>åŸä½ç½® + oldCap</code></li>
<li>è¿™æ ·å¯ä»¥é¿å…é‡æ–°è®¡ç®— hashï¼Œæé«˜æ•ˆç‡</li>
<li>ä¾‹å¦‚ï¼šåŸå®¹é‡ 16ï¼ˆ10000ï¼‰ï¼Œæ‰©å®¹å 32ï¼ˆ100000ï¼‰</li>
</ol></ul>  - å¦‚æœ <code>(e.hash & 16) == 0</code>ï¼Œç´¢å¼•ä¸å˜
  - å¦‚æœ <code>(e.hash & 16) != 0</code>ï¼Œç´¢å¼• = åŸç´¢å¼• + 16</p><h2>å…«ã€çº¢é»‘æ ‘è½¬æ¢</h2><h3>8.1 treeifyBin æ–¹æ³•</h3><p>å½“é“¾è¡¨é•¿åº¦è¾¾åˆ° 8 æ—¶ï¼Œå°è¯•å°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ï¼š</p><p><pre class="language-java" data-lang="java"><code class="language-java">final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) {
    int n, index;
    Node&lt;K,V&gt; e;

    // å¦‚æœæ•°ç»„é•¿åº¦å°äº 64ï¼Œå…ˆæ‰©å®¹è€Œä¸æ˜¯è½¬æ ‘
    if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)
        resize();

    else if ((e = tab[index = (n - 1) &amp; hash]) != null) {
        TreeNode&lt;K,V&gt; hd = null, tl = null;
        do {
            TreeNode&lt;K,V&gt; p = replacementTreeNode(e, null);
            if (tl == null)
                hd = p;
            else {
                p.prev = tl;
                tl.next = p;
            }
            tl = p;
        } while ((e = e.next) != null);

        if ((tab[index] = hd) != null)
            hd.treeify(tab);
    }
}
</code></pre></p><h3>8.2 ä¸ºä»€ä¹ˆæ˜¯ 8 å’Œ 6ï¼Ÿ</h3><ul><ol><li><strong>8 è½¬ 16</strong>ï¼šé“¾è¡¨è½¬çº¢é»‘æ ‘</li>
<li><strong>6 è½¬ 16</strong>ï¼šçº¢é»‘æ ‘è½¬é“¾è¡¨</li>
</ol></ul>
è¿™æ ·è®¾è®¡æ˜¯ä¸ºäº†é¿å…é¢‘ç¹è½¬æ¢ï¼š</p><ul><ol><li>æ ¹æ®æ³Šæ¾åˆ†å¸ƒï¼Œé“¾è¡¨é•¿åº¦è¾¾åˆ° 8 çš„æ¦‚ç‡éå¸¸å°ï¼ˆ0.00000006ï¼‰</li>
<li>å½“é•¿åº¦åœ¨ 6-8 ä¹‹é—´æ³¢åŠ¨æ—¶ï¼Œä¸ä¼šé¢‘ç¹è½¬æ¢</li>
<li>è¿™æ˜¯ä¸€ç§ç©ºé—´å’Œæ—¶é—´çš„æƒè¡¡</li>
</ol></ul>
<h2>ä¹ã€çº¿ç¨‹å®‰å…¨é—®é¢˜</h2><p>HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p><h3>9.1 å¹¶å‘æ‰©å®¹é—®é¢˜</h3><p>JDK 1.7 ä¸­ä½¿ç”¨å¤´æ’æ³•ï¼Œå¹¶å‘æ‰©å®¹å¯èƒ½å¯¼è‡´é“¾è¡¨å½¢æˆç¯ï¼š</p><p><pre class="language-java" data-lang="java"><code class="language-java">void transfer(Entry[] newTable, boolean rehash) {
    int newCapacity = newTable.length;
    for (Entry&lt;K,V&gt; e : table) {
        while(null != e) {
            Entry&lt;K,V&gt; next = e.next;
            if (rehash) {
                e.hash = null == e.key ? 0 : hash(e.key);
            }
            int i = indexFor(e.hash, newCapacity);
            e.next = newTable[i];
            newTable[i] = e;
            e = next;
        }
    }
}
</code></pre></p><h3>9.2 JDK 1.8 çš„æ”¹è¿›</h3><ul><ol><li>æ”¹ç”¨å°¾æ’æ³•ï¼Œé¿å…äº†é“¾è¡¨ç¯çš„é—®é¢˜</li>
<li>ä½†ä»ç„¶å­˜åœ¨æ•°æ®ä¸¢å¤±å’Œè¦†ç›–çš„é—®é¢˜</li>
</ol></ul>
<h3>9.3 è§£å†³æ–¹æ¡ˆ</h3><p>å¦‚æœéœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><ul><ol><li><strong>ConcurrentHashMap</strong>ï¼šçº¿ç¨‹å®‰å…¨çš„ HashMap</li>
<li><strong>Collections.synchronizedMap(new HashMap<>())</strong>ï¼šä½¿ç”¨åŒæ­¥åŒ…è£…å™¨</li>
<li><strong>Hashtable</strong>ï¼šçº¿ç¨‹å®‰å…¨çš„é—ç•™ç±»ï¼ˆä¸æ¨èï¼‰</li>
</ol></ul>
<h2>åã€å¸¸è§é¢è¯•é¢˜</h2><h3>1. HashMap çš„åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ</h3><p>JDK 1.7ï¼šæ•°ç»„ + é“¾è¡¨
JDK 1.8ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘</p><h3>2. ä¸ºä»€ä¹ˆ JDK 1.8 è¦å¼•å…¥çº¢é»‘æ ‘ï¼Ÿ</h3><p>ä¸ºäº†è§£å†³é“¾è¡¨è¿‡é•¿å¯¼è‡´çš„æŸ¥è¯¢æ•ˆç‡é—®é¢˜ã€‚å½“é“¾è¡¨é•¿åº¦è¶…è¿‡ 8 æ—¶ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä» O(n) é™ä½åˆ° O(log n)ã€‚</p><h3>3. HashMap çš„æ‰©å®¹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><ol><li>å½“ size > thresholdï¼ˆcapacity * loadFactorï¼‰æ—¶è§¦å‘æ‰©å®¹</li>
<li>æ‰©å®¹åå®¹é‡å˜ä¸ºåŸæ¥çš„ 2 å€</li>
<li>æ‰©å®¹æ—¶éœ€è¦é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ çš„ä½ç½®ï¼ˆJDK 1.8 æœ‰ä¼˜åŒ–ï¼‰</li>
</ol></ul>
<h3>4. ä¸ºä»€ä¹ˆ HashMap çš„å®¹é‡å¿…é¡»æ˜¯ 2 çš„ n æ¬¡å¹‚ï¼Ÿ</h3><ul><ol><li>æ–¹ä¾¿ä½¿ç”¨ä½è¿ç®—ä»£æ›¿å–æ¨¡è¿ç®—ï¼Œæé«˜æ•ˆç‡</li>
<li>ä½¿ hash åˆ†å¸ƒæ›´å‡åŒ€</li>
<li>ä¾¿äºæ‰©å®¹æ—¶çš„å…ƒç´ è¿ç§»</li>
</ol></ul>
<h3>5. HashMap çš„è´Ÿè½½å› å­ä¸ºä»€ä¹ˆæ˜¯ 0.75ï¼Ÿ</h3><p>è¿™æ˜¯æ—¶é—´å’Œç©ºé—´çš„æƒè¡¡ï¼š</p><ul><ol><li>å¤ªå°ï¼šç©ºé—´åˆ©ç”¨ç‡ä½ï¼Œé¢‘ç¹æ‰©å®¹</li>
<li>å¤ªå¤§ï¼šå“ˆå¸Œå†²çªå¢å¤šï¼ŒæŸ¥è¯¢æ•ˆç‡é™ä½</li>
<li>0.75 æ˜¯ç»è¿‡æ•°å­¦è®¡ç®—çš„æœ€ä¼˜å€¼</li>
</ol></ul>
<h3>6. HashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</h3><p>ä¸æ˜¯ï¼ŒHashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå­˜åœ¨ï¼š</p><ul><ol><li>æ•°æ®ä¸¢å¤±</li>
<li>æ•°æ®è¦†ç›–</li>
<li>JDK 1.7 å¯èƒ½å‡ºç°æ­»å¾ªç¯</li>
</ol></ul>
<h3>7. HashMap ä¸­ key ä¸º null æ—¶æ€ä¹ˆå¤„ç†ï¼Ÿ</h3><p>HashMap å…è®¸ä¸€ä¸ª null é”®ï¼Œnull é”®çš„ hash å€¼ä¸º 0ï¼Œå­˜æ”¾åœ¨æ•°ç»„çš„ç¬¬ 0 ä¸ªä½ç½®ã€‚</p><h3>8. HashMap å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ</h3><p>| ç‰¹æ€§ | HashMap | ConcurrentHashMap |
|------|---------|-------------------|
| çº¿ç¨‹å®‰å…¨ | å¦ | æ˜¯ |
| å®ç°æ–¹å¼ | æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ | æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ + CAS + synchronized |
| null é”®å€¼ | å…è®¸ | ä¸å…è®¸ |
| è¿­ä»£å™¨ | fail-fast | weakly consistent |</p><h3>9. HashMap å’Œ Hashtable çš„åŒºåˆ«ï¼Ÿ</h3><p>| ç‰¹æ€§ | HashMap | Hashtable |
|------|---------|-----------|
| çº¿ç¨‹å®‰å…¨ | å¦ | æ˜¯ |
| null é”®å€¼ | å…è®¸ | ä¸å…è®¸ |
| ç»§æ‰¿ | AbstractMap | Dictionary |
| æ•ˆç‡ | é«˜ | ä½ |</p><h3>10. å¦‚ä½•ä¼˜åŒ– HashMap çš„æ€§èƒ½ï¼Ÿ</h3><ul><ol><li>è®¾ç½®åˆé€‚çš„åˆå§‹å®¹é‡ï¼Œé¿å…é¢‘ç¹æ‰©å®¹</li>
<li>é€‰æ‹©åˆé€‚çš„è´Ÿè½½å› å­</li>
<li>ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ä½œä¸º key</li>
<li>é‡å†™ hashCode å’Œ equals æ–¹æ³•</li>
</ol></ul>
<h2>åä¸€ã€ä½¿ç”¨å»ºè®®</h2><h3>11.1 åˆå§‹åŒ–å®¹é‡</h3><p>å¦‚æœçŸ¥é“å¤§æ¦‚çš„å…ƒç´ æ•°é‡ï¼Œå¯ä»¥è®¾ç½®åˆå§‹å®¹é‡ï¼š</p><p><pre class="language-java" data-lang="java"><code class="language-java">int expectedSize = 10000;
HashMap&lt;String, String&gt; map = new HashMap&lt;&gt;(expectedSize * 4 / 3 + 1);
</code></pre></p><h3>11.2 é€‰æ‹©åˆé€‚çš„è´Ÿè½½å› å­</h3><p>é»˜è®¤ 0.75 é€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼Œå¦‚æœï¼š</p><ul><ol><li>å†…å­˜ç´§å¼ ï¼šå¯ä»¥å¢å¤§è´Ÿè½½å› å­ï¼ˆå¦‚ 0.85ï¼‰</li>
<li>æŸ¥è¯¢æ€§èƒ½è¦æ±‚é«˜ï¼šå¯ä»¥å‡å°è´Ÿè½½å› å­ï¼ˆå¦‚ 0.5ï¼‰</li>
</ol></ul>
<h3>11.3 é¿å…å¤§å¯¹è±¡ä½œä¸º key</h3><p>å¤§å¯¹è±¡çš„ hashCode è®¡ç®—æˆæœ¬é«˜ï¼Œå»ºè®®ä½¿ç”¨ï¼š</p><ul><ol><li>åŸºæœ¬ç±»å‹åŒ…è£…ç±»</li>
<li>String</li>
<li>è‡ªå®šä¹‰çš„ä¸å¯å˜å¯¹è±¡</li>
</ol></ul>
<h2>åäºŒã€æ€»ç»“</h2><p>HashMap æ˜¯ Java é›†åˆæ¡†æ¶ä¸­æœ€é‡è¦çš„ç±»ä¹‹ä¸€ï¼Œå…¶è®¾è®¡ä½“ç°äº†ä»¥ä¸‹æ€æƒ³ï¼š</p><ol><li><strong>å“ˆå¸Œè¡¨çš„ç²¾å¦™è®¾è®¡</strong>ï¼šé€šè¿‡ hash ç®—æ³•å’Œä½è¿ç®—å®ç°å¿«é€ŸæŸ¥æ‰¾</li>
<li><strong>åŠ¨æ€æ‰©å®¹æœºåˆ¶</strong>ï¼šå¹³è¡¡äº†æ—¶é—´å’Œç©ºé—´çš„æ•ˆç‡</li>
<li><strong>çº¢é»‘æ ‘ä¼˜åŒ–</strong>ï¼šè§£å†³äº†é“¾è¡¨è¿‡é•¿çš„é—®é¢˜</li>
<li><strong>ä½è¿ç®—ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ä½è¿ç®—ä»£æ›¿å–æ¨¡ï¼Œæé«˜æ•ˆç‡</li>
</ol>
ç†è§£ HashMap çš„æºç ä¸ä»…æœ‰åŠ©äºé¢è¯•ï¼Œæ›´èƒ½å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´é«˜æ•ˆçš„ä»£ç ã€‚
</p>
        </div>
      </article>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2026 zhizhi2213. All rights reserved.</p>
    </div>
  </footer>

  <script src="/assets/script.js"></script>
</body>
</html>
