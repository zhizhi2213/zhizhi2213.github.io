<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HashMapæºç åˆ†æ - å±å±çš„åšå®¢</title>
  <meta name="description" content="{{post.excerpt}}">
  <link rel="stylesheet" href="/static/assets/style.css">
</head>
<body>
  <div class="background-animation"></div>
  <div class="background-animation background-animation-2"></div>
  
  <header class="header">
    <div class="container">
      <nav class="nav">
        <a href="/" class="logo">å±å±çš„åšå®¢</a>
        <div class="nav-links">
          <a href="/" class="nav-link">é¦–é¡µ</a>
          <a href="/static/archives/" class="nav-link">å½’æ¡£</a>
        </div>
        <button class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
          <span class="theme-icon">ğŸŒ™</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <article class="post">
        <div class="post-header">
          <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
          <h1 class="post-title">HashMapæºç åˆ†æ</h1>
          <div class="post-meta">
            <span class="post-date">2026å¹´2æœˆ9æ—¥</span>
            
          </div>
        </div>
        
        <div class="post-content">
          <h1>HashMap æºç åˆ†æ</h1>
<h2 id="ä¸€ã€hashmap-ç®€ä»‹" tabindex="-1">ä¸€ã€HashMap ç®€ä»‹</h2>
<p>HashMap æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„é›†åˆç±»ä¹‹ä¸€ï¼Œå®ƒåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œæä¾›äº†å¿«é€Ÿçš„é”®å€¼å¯¹å­˜å‚¨å’ŒæŸ¥æ‰¾åŠŸèƒ½ã€‚HashMap å…è®¸ä½¿ç”¨ null é”®å’Œ null å€¼ï¼Œå¹¶ä¸”ä¸ä¿è¯æ˜ å°„çš„é¡ºåºã€‚</p>
<h3 id="ä¸»è¦ç‰¹ç‚¹" tabindex="-1">ä¸»è¦ç‰¹ç‚¹</h3>
<ul>
<li>é”®å€¼å¯¹å­˜å‚¨ï¼ŒåŸºäºå“ˆå¸Œè¡¨å®ç°</li>
<li>å…è®¸ null é”®å’Œ null å€¼</li>
<li>éçº¿ç¨‹å®‰å…¨ï¼Œé€‚ç”¨äºå•çº¿ç¨‹ç¯å¢ƒ</li>
<li>é»˜è®¤åˆå§‹å®¹é‡ä¸º 16ï¼Œé»˜è®¤è´Ÿè½½å› å­ä¸º 0.75</li>
<li>æ‰©å®¹æ—¶å®¹é‡å˜ä¸ºåŸæ¥çš„ 2 å€</li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šå¹³å‡ O(1)ï¼Œæœ€å O(n)</li>
</ul>
<h2 id="äºŒã€æ ¸å¿ƒæ•°æ®ç»“æ„" tabindex="-1">äºŒã€æ ¸å¿ƒæ•°æ®ç»“æ„</h2>
<h3 id="2.1-node-èŠ‚ç‚¹" tabindex="-1">2.1 Node èŠ‚ç‚¹</h3>
<p>HashMap çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª Node å¯¹è±¡ï¼ŒNode æ˜¯ HashMap çš„é™æ€å†…éƒ¨ç±»ï¼š</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
    <span class="token class-name">V</span> value<span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>

    <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hash <span class="token operator">=</span> hash<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">K</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> key<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> key <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">V</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">V</span> oldValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
        value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>o<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="2.2-åº•å±‚ç»“æ„" tabindex="-1">2.2 åº•å±‚ç»“æ„</h3>
<p>HashMap çš„åº•å±‚ç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼š</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span>  <span class="token comment">// å“ˆå¸Œæ¡¶æ•°ç»„</span>

    <span class="token keyword">transient</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span><span class="token punctuation">></span></span> entrySet<span class="token punctuation">;</span>

    <span class="token keyword">transient</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>  <span class="token comment">// å®é™…å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡</span>

    <span class="token keyword">transient</span> <span class="token keyword">int</span> modCount<span class="token punctuation">;</span>  <span class="token comment">// ç»“æ„æ€§ä¿®æ”¹æ¬¡æ•°</span>

    <span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span>  <span class="token comment">// è´Ÿè½½å› å­</span>

    <span class="token keyword">int</span> threshold<span class="token punctuation">;</span>  <span class="token comment">// æ‰©å®¹é˜ˆå€¼ = capacity * loadFactor</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="ä¸‰ã€å…³é”®å‚æ•°" tabindex="-1">ä¸‰ã€å…³é”®å‚æ•°</h2>
<h3 id="3.1-åˆå§‹å‚æ•°" tabindex="-1">3.1 åˆå§‹å‚æ•°</h3>
<pre class="language-java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">// é»˜è®¤åˆå§‹å®¹é‡ 16</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span>  <span class="token comment">// æœ€å¤§å®¹é‡</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span>  <span class="token comment">// é»˜è®¤è´Ÿè½½å› å­</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>  <span class="token comment">// é“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">UNTREEIFY_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>  <span class="token comment">// çº¢é»‘æ ‘è½¬é“¾è¡¨çš„é˜ˆå€¼</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MIN_TREEIFY_CAPACITY</span> <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>  <span class="token comment">// æ¡¶è½¬æ ‘çš„æœ€å°å®¹é‡</span>
</code></pre>
<h3 id="3.2-æ„é€ æ–¹æ³•" tabindex="-1">3.2 æ„é€ æ–¹æ³•</h3>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal initial capacity: "</span> <span class="token operator">+</span>
                                           initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span>
        initialCapacity <span class="token operator">=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>loadFactor <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal load factor: "</span> <span class="token operator">+</span>
                                           loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> loadFactor<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>threshold <span class="token operator">=</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="3.3-tablesizefor-æ–¹æ³•" tabindex="-1">3.3 tableSizeFor æ–¹æ³•</h3>
<p>è¿™ä¸ªæ–¹æ³•ç”¨äºå°†ç»™å®šçš„å®¹é‡è°ƒæ•´ä¸º 2 çš„ n æ¬¡å¹‚ï¼š</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> cap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">8</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>n <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">:</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•é€šè¿‡ä¸€ç³»åˆ—çš„ä½è¿ç®—ï¼Œå°†æœ€é«˜ä½çš„ 1 åé¢çš„æ‰€æœ‰ä½éƒ½ç½®ä¸º 1ï¼Œç„¶ååŠ  1ï¼Œå¾—åˆ°ä¸€ä¸ª 2 çš„ n æ¬¡å¹‚ã€‚</p>
<h2 id="å››ã€hash-ç®—æ³•" tabindex="-1">å››ã€Hash ç®—æ³•</h2>
<h3 id="4.1-hash-æ–¹æ³•" tabindex="-1">4.1 hash æ–¹æ³•</h3>
<p>HashMap é€šè¿‡ hash æ–¹æ³•è®¡ç®— key çš„å“ˆå¸Œå€¼ï¼š</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> h<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Ÿ</strong></p>
<ul>
<li><code>h &gt;&gt;&gt; 16</code> å°†å“ˆå¸Œå€¼çš„é«˜ 16 ä½æ— ç¬¦å·å³ç§» 16 ä½</li>
<li><code>^</code> æ“ä½œå°†é«˜ 16 ä½å’Œä½ 16 ä½è¿›è¡Œå¼‚æˆ–</li>
<li>è¿™æ ·åšçš„å¥½å¤„æ˜¯è®©é«˜ä½çš„ç‰¹å¾ä¹Ÿèƒ½å‚ä¸åˆ°ä½ä½çš„è¿ç®—ä¸­ï¼Œå‡å°‘å“ˆå¸Œå†²çª</li>
</ul>
<h3 id="4.2-ç´¢å¼•è®¡ç®—" tabindex="-1">4.2 ç´¢å¼•è®¡ç®—</h3>
<p>é€šè¿‡ hash å€¼è®¡ç®—åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®ï¼š</p>
<pre class="language-java"><code class="language-java">index <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash
</code></pre>
<p>å…¶ä¸­ n æ˜¯æ•°ç»„é•¿åº¦ï¼Œå¿…é¡»æ˜¯ 2 çš„ n æ¬¡å¹‚ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ä½è¿ç®—è€Œä¸æ˜¯å–æ¨¡ï¼Ÿ</strong></p>
<ul>
<li>ä½è¿ç®—æ•ˆç‡æ›´é«˜</li>
<li>å½“ n æ˜¯ 2 çš„ n æ¬¡å¹‚æ—¶ï¼Œ<code>(n - 1) &amp; hash</code> ç­‰ä»·äº <code>hash % n</code></li>
<li><code>(n - 1)</code> çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯å…¨ 1ï¼Œå¦‚ 16-1=15ï¼ŒäºŒè¿›åˆ¶ä¸º 1111</li>
</ul>
<h2 id="äº”ã€put-æ–¹æ³•æºç åˆ†æ" tabindex="-1">äº”ã€put æ–¹æ³•æºç åˆ†æ</h2>
<h3 id="5.1-put-æ–¹æ³•å…¥å£" tabindex="-1">5.1 put æ–¹æ³•å…¥å£</h3>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="5.2-putval-æ–¹æ³•è¯¦è§£" tabindex="-1">5.2 putVal æ–¹æ³•è¯¦è§£</h3>
<pre class="language-java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>
               <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span>
    <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>

    <span class="token comment">// 1. å¦‚æœ table ä¸ºç©ºæˆ–é•¿åº¦ä¸º 0ï¼Œè¿›è¡Œåˆå§‹åŒ–</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    <span class="token comment">// 2. è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå¦‚æœè¯¥ä½ç½®ä¸ºç©ºï¼Œç›´æ¥æ’å…¥æ–°èŠ‚ç‚¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>
        <span class="token class-name">K</span> k<span class="token punctuation">;</span>

        <span class="token comment">// 3. åˆ¤æ–­è¯¥ä½ç½®çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸è¦æ’å…¥çš„ key ç›¸åŒ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> p<span class="token punctuation">;</span>

        <span class="token comment">// 4. å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œè°ƒç”¨çº¢é»‘æ ‘çš„æ’å…¥æ–¹æ³•</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5. å¦åˆ™æ˜¯é“¾è¡¨ï¼Œéå†é“¾è¡¨</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åˆ°è¾¾é“¾è¡¨å°¾éƒ¨ï¼Œæ’å…¥æ–°èŠ‚ç‚¹</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// é“¾è¡¨é•¿åº¦è¾¾åˆ° 8ï¼Œè½¬ä¸ºçº¢é»‘æ ‘</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                        <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// æ‰¾åˆ°ç›¸åŒçš„ key</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                p <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 6. å¦‚æœæ‰¾åˆ°ç›¸åŒçš„ keyï¼Œè¦†ç›–æ—§å€¼</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
    <span class="token comment">// 7. åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="å…­ã€get-æ–¹æ³•æºç åˆ†æ" tabindex="-1">å…­ã€get æ–¹æ³•æºç åˆ†æ</h2>
<h3 id="6.1-get-æ–¹æ³•å…¥å£" tabindex="-1">6.1 get æ–¹æ³•å…¥å£</h3>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="6.2-getnode-æ–¹æ³•è¯¦è§£" tabindex="-1">6.2 getNode æ–¹æ³•è¯¦è§£</h3>
<pre class="language-java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> first<span class="token punctuation">,</span> e<span class="token punctuation">;</span>
    <span class="token keyword">int</span> n<span class="token punctuation">;</span>
    <span class="token class-name">K</span> k<span class="token punctuation">;</span>

    <span class="token comment">// 1. æ£€æŸ¥ table æ˜¯å¦ä¸ºç©º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span>first <span class="token operator">=</span> tab<span class="token punctuation">[</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 2. æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åŒ¹é…</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> first<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> first<span class="token punctuation">;</span>

        <span class="token comment">// 3. æ£€æŸ¥åç»­èŠ‚ç‚¹</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> first<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>first<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTreeNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// åœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾</span>
            <span class="token keyword">do</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="ä¸ƒã€æ‰©å®¹æœºåˆ¶ï¼ˆresizeï¼‰" tabindex="-1">ä¸ƒã€æ‰©å®¹æœºåˆ¶ï¼ˆresizeï¼‰</h2>
<h3 id="7.1-resize-æ–¹æ³•è¯¦è§£" tabindex="-1">7.1 resize æ–¹æ³•è¯¦è§£</h3>
<pre class="language-java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span>
    <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// 1. è®¡ç®—æ–°å®¹é‡å’Œæ–°é˜ˆå€¼</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span>
                 oldCap <span class="token operator">>=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span>
            newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
        newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        newCap <span class="token operator">=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">*</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">?</span>
                  <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span>

    <span class="token comment">// 2. åˆ›å»ºæ–°æ•°ç»„</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span><span class="token string">"unchecked"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span>
    table <span class="token operator">=</span> newTab<span class="token punctuation">;</span>

    <span class="token comment">// 3. è¿ç§»æ—§æ•°ç»„ä¸­çš„å…ƒç´ </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// é“¾è¡¨ä¼˜åŒ–ï¼šå°†é“¾è¡¨åˆ†ä¸ºåŸç´¢å¼•å’ŒåŸç´¢å¼•+oldCapä¸¤ä¸ªä½ç½®</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>
                    <span class="token keyword">do</span> <span class="token punctuation">{</span>
                        next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                loHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            loTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newTab<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="7.2-æ‰©å®¹ä¼˜åŒ–" tabindex="-1">7.2 æ‰©å®¹ä¼˜åŒ–</h3>
<p>JDK 1.8 å¯¹æ‰©å®¹è¿›è¡Œäº†ä¼˜åŒ–ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>(e.hash &amp; oldCap)</code> åˆ¤æ–­å…ƒç´ æ˜¯åœ¨åŸä½ç½®è¿˜æ˜¯ç§»åŠ¨åˆ° <code>åŸä½ç½® + oldCap</code></li>
<li>è¿™æ ·å¯ä»¥é¿å…é‡æ–°è®¡ç®— hashï¼Œæé«˜æ•ˆç‡</li>
<li>ä¾‹å¦‚ï¼šåŸå®¹é‡ 16ï¼ˆ10000ï¼‰ï¼Œæ‰©å®¹å 32ï¼ˆ100000ï¼‰
<ul>
<li>å¦‚æœ <code>(e.hash &amp; 16) == 0</code>ï¼Œç´¢å¼•ä¸å˜</li>
<li>å¦‚æœ <code>(e.hash &amp; 16) != 0</code>ï¼Œç´¢å¼• = åŸç´¢å¼• + 16</li>
</ul>
</li>
</ul>
<h2 id="å…«ã€çº¢é»‘æ ‘è½¬æ¢" tabindex="-1">å…«ã€çº¢é»‘æ ‘è½¬æ¢</h2>
<h3 id="8.1-treeifybin-æ–¹æ³•" tabindex="-1">8.1 treeifyBin æ–¹æ³•</h3>
<p>å½“é“¾è¡¨é•¿åº¦è¾¾åˆ° 8 æ—¶ï¼Œå°è¯•å°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ï¼š</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">treeifyBin</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">,</span> <span class="token keyword">int</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> n<span class="token punctuation">,</span> index<span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>

    <span class="token comment">// å¦‚æœæ•°ç»„é•¿åº¦å°äº 64ï¼Œå…ˆæ‰©å®¹è€Œä¸æ˜¯è½¬æ ‘</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tab <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MIN_TREEIFY_CAPACITY</span><span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> tab<span class="token punctuation">[</span>index <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hd <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> tl <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> <span class="token function">replacementTreeNode</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tl <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                hd <span class="token operator">=</span> p<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                p<span class="token punctuation">.</span>prev <span class="token operator">=</span> tl<span class="token punctuation">;</span>
                tl<span class="token punctuation">.</span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            tl <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> hd<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            hd<span class="token punctuation">.</span><span class="token function">treeify</span><span class="token punctuation">(</span>tab<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="8.2-ä¸ºä»€ä¹ˆæ˜¯-8-å’Œ-6ï¼Ÿ" tabindex="-1">8.2 ä¸ºä»€ä¹ˆæ˜¯ 8 å’Œ 6ï¼Ÿ</h3>
<ul>
<li><strong>8 è½¬ 16</strong>ï¼šé“¾è¡¨è½¬çº¢é»‘æ ‘</li>
<li><strong>6 è½¬ 16</strong>ï¼šçº¢é»‘æ ‘è½¬é“¾è¡¨</li>
</ul>
<p>è¿™æ ·è®¾è®¡æ˜¯ä¸ºäº†é¿å…é¢‘ç¹è½¬æ¢ï¼š</p>
<ul>
<li>æ ¹æ®æ³Šæ¾åˆ†å¸ƒï¼Œé“¾è¡¨é•¿åº¦è¾¾åˆ° 8 çš„æ¦‚ç‡éå¸¸å°ï¼ˆ0.00000006ï¼‰</li>
<li>å½“é•¿åº¦åœ¨ 6-8 ä¹‹é—´æ³¢åŠ¨æ—¶ï¼Œä¸ä¼šé¢‘ç¹è½¬æ¢</li>
<li>è¿™æ˜¯ä¸€ç§ç©ºé—´å’Œæ—¶é—´çš„æƒè¡¡</li>
</ul>
<h2 id="ä¹ã€çº¿ç¨‹å®‰å…¨é—®é¢˜" tabindex="-1">ä¹ã€çº¿ç¨‹å®‰å…¨é—®é¢˜</h2>
<p>HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<h3 id="9.1-å¹¶å‘æ‰©å®¹é—®é¢˜" tabindex="-1">9.1 å¹¶å‘æ‰©å®¹é—®é¢˜</h3>
<p>JDK 1.7 ä¸­ä½¿ç”¨å¤´æ’æ³•ï¼Œå¹¶å‘æ‰©å®¹å¯èƒ½å¯¼è‡´é“¾è¡¨å½¢æˆç¯ï¼š</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable<span class="token punctuation">,</span> <span class="token keyword">boolean</span> rehash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> newTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">:</span> table<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rehash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token operator">==</span> e<span class="token punctuation">.</span>key <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>next <span class="token operator">=</span> newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
            e <span class="token operator">=</span> next<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="9.2-jdk-1.8-çš„æ”¹è¿›" tabindex="-1">9.2 JDK 1.8 çš„æ”¹è¿›</h3>
<ul>
<li>æ”¹ç”¨å°¾æ’æ³•ï¼Œé¿å…äº†é“¾è¡¨ç¯çš„é—®é¢˜</li>
<li>ä½†ä»ç„¶å­˜åœ¨æ•°æ®ä¸¢å¤±å’Œè¦†ç›–çš„é—®é¢˜</li>
</ul>
<h3 id="9.3-è§£å†³æ–¹æ¡ˆ" tabindex="-1">9.3 è§£å†³æ–¹æ¡ˆ</h3>
<p>å¦‚æœéœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<ul>
<li><strong>ConcurrentHashMap</strong>ï¼šçº¿ç¨‹å®‰å…¨çš„ HashMap</li>
<li><strong>Collections.synchronizedMap(new HashMap&lt;&gt;())</strong>ï¼šä½¿ç”¨åŒæ­¥åŒ…è£…å™¨</li>
<li><strong>Hashtable</strong>ï¼šçº¿ç¨‹å®‰å…¨çš„é—ç•™ç±»ï¼ˆä¸æ¨èï¼‰</li>
</ul>
<h2 id="åã€å¸¸è§é¢è¯•é¢˜" tabindex="-1">åã€å¸¸è§é¢è¯•é¢˜</h2>
<h3 id="1.-hashmap-çš„åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ" tabindex="-1">1. HashMap çš„åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ</h3>
<p>JDK 1.7ï¼šæ•°ç»„ + é“¾è¡¨<br>
JDK 1.8ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘</p>
<h3 id="2.-ä¸ºä»€ä¹ˆ-jdk-1.8-è¦å¼•å…¥çº¢é»‘æ ‘ï¼Ÿ" tabindex="-1">2. ä¸ºä»€ä¹ˆ JDK 1.8 è¦å¼•å…¥çº¢é»‘æ ‘ï¼Ÿ</h3>
<p>ä¸ºäº†è§£å†³é“¾è¡¨è¿‡é•¿å¯¼è‡´çš„æŸ¥è¯¢æ•ˆç‡é—®é¢˜ã€‚å½“é“¾è¡¨é•¿åº¦è¶…è¿‡ 8 æ—¶ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä» O(n) é™ä½åˆ° O(log n)ã€‚</p>
<h3 id="3.-hashmap-çš„æ‰©å®¹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ" tabindex="-1">3. HashMap çš„æ‰©å®¹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<ul>
<li>å½“ size &gt; thresholdï¼ˆcapacity * loadFactorï¼‰æ—¶è§¦å‘æ‰©å®¹</li>
<li>æ‰©å®¹åå®¹é‡å˜ä¸ºåŸæ¥çš„ 2 å€</li>
<li>æ‰©å®¹æ—¶éœ€è¦é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ çš„ä½ç½®ï¼ˆJDK 1.8 æœ‰ä¼˜åŒ–ï¼‰</li>
</ul>
<h3 id="4.-ä¸ºä»€ä¹ˆ-hashmap-çš„å®¹é‡å¿…é¡»æ˜¯-2-çš„-n-æ¬¡å¹‚ï¼Ÿ" tabindex="-1">4. ä¸ºä»€ä¹ˆ HashMap çš„å®¹é‡å¿…é¡»æ˜¯ 2 çš„ n æ¬¡å¹‚ï¼Ÿ</h3>
<ul>
<li>æ–¹ä¾¿ä½¿ç”¨ä½è¿ç®—ä»£æ›¿å–æ¨¡è¿ç®—ï¼Œæé«˜æ•ˆç‡</li>
<li>ä½¿ hash åˆ†å¸ƒæ›´å‡åŒ€</li>
<li>ä¾¿äºæ‰©å®¹æ—¶çš„å…ƒç´ è¿ç§»</li>
</ul>
<h3 id="5.-hashmap-çš„è´Ÿè½½å› å­ä¸ºä»€ä¹ˆæ˜¯-0.75ï¼Ÿ" tabindex="-1">5. HashMap çš„è´Ÿè½½å› å­ä¸ºä»€ä¹ˆæ˜¯ 0.75ï¼Ÿ</h3>
<p>è¿™æ˜¯æ—¶é—´å’Œç©ºé—´çš„æƒè¡¡ï¼š</p>
<ul>
<li>å¤ªå°ï¼šç©ºé—´åˆ©ç”¨ç‡ä½ï¼Œé¢‘ç¹æ‰©å®¹</li>
<li>å¤ªå¤§ï¼šå“ˆå¸Œå†²çªå¢å¤šï¼ŒæŸ¥è¯¢æ•ˆç‡é™ä½</li>
<li>0.75 æ˜¯ç»è¿‡æ•°å­¦è®¡ç®—çš„æœ€ä¼˜å€¼</li>
</ul>
<h3 id="6.-hashmap-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ" tabindex="-1">6. HashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</h3>
<p>ä¸æ˜¯ï¼ŒHashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå­˜åœ¨ï¼š</p>
<ul>
<li>æ•°æ®ä¸¢å¤±</li>
<li>æ•°æ®è¦†ç›–</li>
<li>JDK 1.7 å¯èƒ½å‡ºç°æ­»å¾ªç¯</li>
</ul>
<h3 id="7.-hashmap-ä¸­-key-ä¸º-null-æ—¶æ€ä¹ˆå¤„ç†ï¼Ÿ" tabindex="-1">7. HashMap ä¸­ key ä¸º null æ—¶æ€ä¹ˆå¤„ç†ï¼Ÿ</h3>
<p>HashMap å…è®¸ä¸€ä¸ª null é”®ï¼Œnull é”®çš„ hash å€¼ä¸º 0ï¼Œå­˜æ”¾åœ¨æ•°ç»„çš„ç¬¬ 0 ä¸ªä½ç½®ã€‚</p>
<h3 id="8.-hashmap-å’Œ-concurrenthashmap-çš„åŒºåˆ«ï¼Ÿ" tabindex="-1">8. HashMap å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>HashMap</th>
<th>ConcurrentHashMap</th>
</tr>
</thead>
<tbody>
<tr>
<td>çº¿ç¨‹å®‰å…¨</td>
<td>å¦</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>å®ç°æ–¹å¼</td>
<td>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</td>
<td>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ + CAS + synchronized</td>
</tr>
<tr>
<td>null é”®å€¼</td>
<td>å…è®¸</td>
<td>ä¸å…è®¸</td>
</tr>
<tr>
<td>è¿­ä»£å™¨</td>
<td>fail-fast</td>
<td>weakly consistent</td>
</tr>
</tbody>
</table>
<h3 id="9.-hashmap-å’Œ-hashtable-çš„åŒºåˆ«ï¼Ÿ" tabindex="-1">9. HashMap å’Œ Hashtable çš„åŒºåˆ«ï¼Ÿ</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>HashMap</th>
<th>Hashtable</th>
</tr>
</thead>
<tbody>
<tr>
<td>çº¿ç¨‹å®‰å…¨</td>
<td>å¦</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>null é”®å€¼</td>
<td>å…è®¸</td>
<td>ä¸å…è®¸</td>
</tr>
<tr>
<td>ç»§æ‰¿</td>
<td>AbstractMap</td>
<td>Dictionary</td>
</tr>
<tr>
<td>æ•ˆç‡</td>
<td>é«˜</td>
<td>ä½</td>
</tr>
</tbody>
</table>
<h3 id="10.-å¦‚ä½•ä¼˜åŒ–-hashmap-çš„æ€§èƒ½ï¼Ÿ" tabindex="-1">10. å¦‚ä½•ä¼˜åŒ– HashMap çš„æ€§èƒ½ï¼Ÿ</h3>
<ul>
<li>è®¾ç½®åˆé€‚çš„åˆå§‹å®¹é‡ï¼Œé¿å…é¢‘ç¹æ‰©å®¹</li>
<li>é€‰æ‹©åˆé€‚çš„è´Ÿè½½å› å­</li>
<li>ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ä½œä¸º key</li>
<li>é‡å†™ hashCode å’Œ equals æ–¹æ³•</li>
</ul>
<h2 id="åä¸€ã€ä½¿ç”¨å»ºè®®" tabindex="-1">åä¸€ã€ä½¿ç”¨å»ºè®®</h2>
<h3 id="11.1-åˆå§‹åŒ–å®¹é‡" tabindex="-1">11.1 åˆå§‹åŒ–å®¹é‡</h3>
<p>å¦‚æœçŸ¥é“å¤§æ¦‚çš„å…ƒç´ æ•°é‡ï¼Œå¯ä»¥è®¾ç½®åˆå§‹å®¹é‡ï¼š</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">int</span> expectedSize <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>expectedSize <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">/</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="11.2-é€‰æ‹©åˆé€‚çš„è´Ÿè½½å› å­" tabindex="-1">11.2 é€‰æ‹©åˆé€‚çš„è´Ÿè½½å› å­</h3>
<p>é»˜è®¤ 0.75 é€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼Œå¦‚æœï¼š</p>
<ul>
<li>å†…å­˜ç´§å¼ ï¼šå¯ä»¥å¢å¤§è´Ÿè½½å› å­ï¼ˆå¦‚ 0.85ï¼‰</li>
<li>æŸ¥è¯¢æ€§èƒ½è¦æ±‚é«˜ï¼šå¯ä»¥å‡å°è´Ÿè½½å› å­ï¼ˆå¦‚ 0.5ï¼‰</li>
</ul>
<h3 id="11.3-é¿å…å¤§å¯¹è±¡ä½œä¸º-key" tabindex="-1">11.3 é¿å…å¤§å¯¹è±¡ä½œä¸º key</h3>
<p>å¤§å¯¹è±¡çš„ hashCode è®¡ç®—æˆæœ¬é«˜ï¼Œå»ºè®®ä½¿ç”¨ï¼š</p>
<ul>
<li>åŸºæœ¬ç±»å‹åŒ…è£…ç±»</li>
<li>String</li>
<li>è‡ªå®šä¹‰çš„ä¸å¯å˜å¯¹è±¡</li>
</ul>
<h2 id="åäºŒã€æ€»ç»“" tabindex="-1">åäºŒã€æ€»ç»“</h2>
<p>HashMap æ˜¯ Java é›†åˆæ¡†æ¶ä¸­æœ€é‡è¦çš„ç±»ä¹‹ä¸€ï¼Œå…¶è®¾è®¡ä½“ç°äº†ä»¥ä¸‹æ€æƒ³ï¼š</p>
<ol>
<li><strong>å“ˆå¸Œè¡¨çš„ç²¾å¦™è®¾è®¡</strong>ï¼šé€šè¿‡ hash ç®—æ³•å’Œä½è¿ç®—å®ç°å¿«é€ŸæŸ¥æ‰¾</li>
<li><strong>åŠ¨æ€æ‰©å®¹æœºåˆ¶</strong>ï¼šå¹³è¡¡äº†æ—¶é—´å’Œç©ºé—´çš„æ•ˆç‡</li>
<li><strong>çº¢é»‘æ ‘ä¼˜åŒ–</strong>ï¼šè§£å†³äº†é“¾è¡¨è¿‡é•¿çš„é—®é¢˜</li>
<li><strong>ä½è¿ç®—ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ä½è¿ç®—ä»£æ›¿å–æ¨¡ï¼Œæé«˜æ•ˆç‡</li>
</ol>
<p>ç†è§£ HashMap çš„æºç ä¸ä»…æœ‰åŠ©äºé¢è¯•ï¼Œæ›´èƒ½å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´é«˜æ•ˆçš„ä»£ç ã€‚</p>

        </div>
      </article>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2026 zhizhi2213. All rights reserved.</p>
    </div>
  </footer>

  <script src="/static/assets/script.js"></script>
</body>
</html>
