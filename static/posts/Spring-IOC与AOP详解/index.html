<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spring IOCä¸AOPè¯¦è§£ - å±å±çš„åšå®¢</title>
  <meta name="description" content="{{post.excerpt}}">
  <link rel="stylesheet" href="/static/assets/style.css">
</head>
<body>
  <div class="background-animation"></div>
  <div class="background-animation background-animation-2"></div>
  
  <header class="header">
    <div class="container">
      <nav class="nav">
        <a href="/" class="logo">å±å±çš„åšå®¢</a>
        <div class="nav-links">
          <a href="/" class="nav-link">é¦–é¡µ</a>
          <a href="/static/archives/" class="nav-link">å½’æ¡£</a>
        </div>
        <button class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
          <span class="theme-icon">ğŸŒ™</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <article class="post">
        <div class="post-header">
          <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
          <h1 class="post-title">Spring IOCä¸AOPè¯¦è§£</h1>
          <div class="post-meta">
            <span class="post-date">2026å¹´2æœˆ10æ—¥</span>
            <span class="post-tag">Spring</span><span class="post-tag">IOC</span><span class="post-tag">AOP</span><span class="post-tag">Java</span>
          </div>
        </div>
        
        <div class="post-content">
          <h1>Spring IOCä¸AOPè¯¦è§£</h1>

Springæ¡†æ¶æ˜¯Javaå¼€å‘ä¸­æœ€æµè¡Œçš„æ¡†æ¶ä¹‹ä¸€ï¼Œå…¶æ ¸å¿ƒç‰¹æ€§IOCï¼ˆæ§åˆ¶åè½¬ï¼‰å’ŒAOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ„æˆäº†Springçš„åŸºç¡€ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æè¿™ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚

<h2>ç¬¬ä¸€éƒ¨åˆ†ï¼šIOCï¼ˆæ§åˆ¶åè½¬ï¼‰</h2>

<h3>ä»€ä¹ˆæ˜¯IOCï¼Ÿ</h3>

IOCï¼ˆInversion of Controlï¼Œæ§åˆ¶åè½¬ï¼‰æ˜¯Springçš„æ ¸å¿ƒæ€æƒ³ï¼Œå®ƒå°†å¯¹è±¡çš„åˆ›å»ºã€ç®¡ç†å’Œä¾èµ–å…³ç³»çš„ç»´æŠ¤äº¤ç»™Springå®¹å™¨æ¥å¤„ç†ï¼Œè€Œä¸æ˜¯ç”±å¯¹è±¡è‡ªå·±ç®¡ç†ã€‚

<h4>ä¼ ç»Ÿå¼€å‘æ–¹å¼çš„é—®é¢˜</h4>

<pre class="language-java" data-lang="java"><code class="language-java">public class UserService {
    private UserDao userDao;

    public UserService() {
        // å¼ºä¾èµ–ï¼šç›´æ¥åˆ›å»ºä¾èµ–å¯¹è±¡ï¼Œè€¦åˆåº¦é«˜
        this.userDao = new UserDaoImpl();
    }

    public void addUser(User user) {
        userDao.save(user);
    }
}
</code></pre>

è¿™ç§æ–¹å¼çš„é—®é¢˜ï¼š
<ul><ol><li>è€¦åˆåº¦é«˜ï¼Œéš¾ä»¥æ›¿æ¢å®ç°</li></ol></ul>
<ul><ol><li>ä¸ä¾¿äºå•å…ƒæµ‹è¯•</li></ol></ul>
<ul><ol><li>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸéš¾ä»¥ç®¡ç†</li></ol></ul>

<h4>IOCçš„è§£å†³æ–¹æ¡ˆ</h4>

<pre class="language-java" data-lang="java"><code class="language-java">public class UserService {
    private UserDao userDao;

    // é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
    public UserService(UserDao userDao) {
        this.userDao = userDao;
    }

    public void addUser(User user) {
        userDao.save(user);
    }
}
</code></pre>

<h3>IOCå®¹å™¨</h3>

Springæä¾›äº†ä¸¤ç§IOCå®¹å™¨ï¼š

<ol><li><strong>BeanFactory</strong>ï¼šåŸºç¡€å®¹å™¨ï¼Œæä¾›åŸºæœ¬çš„IOCåŠŸèƒ½</li></ol>
<ol><li><strong>ApplicationContext</strong>ï¼šé«˜çº§å®¹å™¨ï¼Œæä¾›æ›´å¤šä¼ä¸šçº§ç‰¹æ€§</li></ol>

<h4>BeanFactory</h4>

<pre class="language-java" data-lang="java"><code class="language-java">// BeanFactoryæ¥å£å®šä¹‰
public interface BeanFactory {

    // æ ¹æ®åç§°è·å–Bean
    Object getBean(String name) throws BeansException;

    // æ ¹æ®ç±»å‹è·å–Bean
    &lt;T&gt; T getBean(Class&lt;T&gt; requiredType) throws BeansException;

    // åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šBean
    boolean containsBean(String name);

    // åˆ¤æ–­Beanæ˜¯å¦æ˜¯å•ä¾‹
    boolean isSingleton(String name) throws NoSuchBeanDefinitionException;
}
</code></pre>

<h4>ApplicationContext</h4>

<pre class="language-java" data-lang="java"><code class="language-java">// å¸¸ç”¨çš„ApplicationContextå®ç°
// 1. ClassPathXmlApplicationContextï¼šä»ç±»è·¯å¾„åŠ è½½é…ç½®
ApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");

// 2. FileSystemXmlApplicationContextï¼šä»æ–‡ä»¶ç³»ç»ŸåŠ è½½é…ç½®
ApplicationContext context = new FileSystemXmlApplicationContext("D:/config/applicationContext.xml");

// 3. AnnotationConfigApplicationContextï¼šåŸºäºæ³¨è§£çš„é…ç½®
ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);

// 4. WebApplicationContextï¼šWebåº”ç”¨çš„å®¹å™¨ï¼ˆåœ¨Spring MVCä¸­ä½¿ç”¨ï¼‰
</code></pre>

<h3>ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„ä¸‰ç§æ–¹å¼</h3>

<h4>1. æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆæ¨èï¼‰</h4>

<pre class="language-java" data-lang="java"><code class="language-java">@Service
public class UserService {
    private final UserDao userDao;
    private final EmailService emailService;

    // æ„é€ å‡½æ•°æ³¨å…¥ï¼šä¿è¯ä¾èµ–ä¸å¯å˜ï¼Œæ˜“äºæµ‹è¯•
    public UserService(UserDao userDao, EmailService emailService) {
        this.userDao = userDao;
        this.emailService = emailService;
    }

    public void registerUser(User user) {
        userDao.save(user);
        emailService.sendWelcomeEmail(user.getEmail());
    }
}
</code></pre>

<h4>2. Setteræ–¹æ³•æ³¨å…¥</h4>

<pre class="language-java" data-lang="java"><code class="language-java">@Service
public class UserService {
    private UserDao userDao;
    private EmailService emailService;

    @Autowired
    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }

    @Autowired
    public void setEmailService(EmailService emailService) {
        this.emailService = emailService;
    }

    public void registerUser(User user) {
        userDao.save(user);
        emailService.sendWelcomeEmail(user.getEmail());
    }
}
</code></pre>

<h4>3. å­—æ®µæ³¨å…¥ï¼ˆä¸æ¨èï¼‰</h4>

<pre class="language-java" data-lang="java"><code class="language-java">@Service
public class UserService {
    @Autowired
    private UserDao userDao;

    @Autowired
    private EmailService emailService;

    public void registerUser(User user) {
        userDao.save(user);
        emailService.sendWelcomeEmail(user.getEmail());
    }
}
</code></pre>

<strong>ä¸ºä»€ä¹ˆæ¨èæ„é€ å‡½æ•°æ³¨å…¥ï¼Ÿ</strong>
<ul><ol><li>ä¿è¯ä¾èµ–ä¸å¯å˜ï¼ˆfinalï¼‰</li></ol></ul>
<ul><ol><li>æ˜ç¡®è¡¨è¾¾ç±»çš„ä¾èµ–å…³ç³»</li></ol></ul>
<ul><ol><li>ä¾¿äºå•å…ƒæµ‹è¯•ï¼ˆå¯ä»¥è½»æ¾mockä¾èµ–ï¼‰</li></ol></ul>
<ul><ol><li>é¿å…å¾ªç¯ä¾èµ–</li></ol></ul>

<h3>Beançš„é…ç½®æ–¹å¼</h3>

<h4>XMLé…ç½®æ–¹å¼</h4>

<pre class="language-xml" data-lang="xml"><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context.xsd"&gt;

    &lt;!-- æ‰«ææ³¨è§£ --&gt;
    &lt;context:component-scan base-package="com.example"/&gt;

    &lt;!-- å®šä¹‰Bean --&gt;
    &lt;bean id="userDao" class="com.example.dao.UserDaoImpl"/&gt;

    &lt;bean id="userService" class="com.example.service.UserService"&gt;
        &lt;!-- æ„é€ å‡½æ•°æ³¨å…¥ --&gt;
        &lt;constructor-arg ref="userDao"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>

<h4>æ³¨è§£é…ç½®æ–¹å¼</h4>

<pre class="language-java" data-lang="java"><code class="language-java">@Configuration
@ComponentScan("com.example")
public class AppConfig {

    @Bean
    public UserDao userDao() {
        return new UserDaoImpl();
    }

    @Bean
    public UserService userService(UserDao userDao) {
        return new UserService(userDao);
    }
}
</code></pre>

<h4>è‡ªåŠ¨è£…é…æ³¨è§£</h4>

<pre class="language-java" data-lang="java"><code class="language-java">// @Componentï¼šé€šç”¨çš„ç»„ä»¶æ³¨è§£
@Component
public class UserDaoImpl implements UserDao {
    // å®ç°ä»£ç 
}

// @Repositoryï¼šæ•°æ®è®¿é—®å±‚
@Repository
public class UserDaoImpl implements UserDao {
    // å®ç°ä»£ç 
}

// @Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚
@Service
public class UserService {
    // å®ç°ä»£ç 
}

// @Controllerï¼šæ§åˆ¶å™¨å±‚
@Controller
public class UserController {
    // å®ç°ä»£ç 
}

// @Autowiredï¼šè‡ªåŠ¨è£…é…
@Service
public class UserService {
    @Autowired
    private UserDao userDao;

    @Autowired
    @Qualifier("userDaoImpl") // æŒ‡å®šBeanåç§°
    private UserDao userDao2;

    @Resource(name = "userDaoImpl") // JSR-250æ³¨è§£
    private UserDao userDao3;
}
</code></pre>

<h3>Beançš„ç”Ÿå‘½å‘¨æœŸ</h3>

Spring Beançš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š

<pre class="language-java" data-lang="java"><code class="language-java">@Component
public class LifeCycleBean implements BeanNameAware, BeanFactoryAware,
        InitializingBean, DisposableBean {

    private String beanName;

    // 1. å®ä¾‹åŒ–Beanï¼ˆæ„é€ å‡½æ•°ï¼‰
    public LifeCycleBean() {
        System.out.println("1. å®ä¾‹åŒ–Bean");
    }

    // 2. è®¾ç½®å±æ€§å€¼
    @Autowired
    private UserDao userDao;
    public void setUserDao(UserDao userDao) {
        System.out.println("2. è®¾ç½®å±æ€§å€¼");
        this.userDao = userDao;
    }

    // 3. BeanNameAwareæ¥å£å›è°ƒ
    @Override
    public void setBeanName(String name) {
        System.out.println("3. BeanNameAware.setBeanName: " + name);
        this.beanName = name;
    }

    // 4. BeanFactoryAwareæ¥å£å›è°ƒ
    @Override
    public void setBeanFactory(BeanFactory beanFactory) {
        System.out.println("4. BeanFactoryAware.setBeanFactory");
    }

    // 5. BeanPostProcessor - å‰ç½®å¤„ç†
    @PostConstruct
    public void initMethod() {
        System.out.println("5. @PostConstructåˆå§‹åŒ–æ–¹æ³•");
    }

    // 6. InitializingBeanæ¥å£å›è°ƒ
    @Override
    public void afterPropertiesSet() {
        System.out.println("6. InitializingBean.afterPropertiesSet");
    }

    // 7. BeanPostProcessor - åç½®å¤„ç†
    @Bean(initMethod = "customInit")
    public void customInit() {
        System.out.println("7. è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•");
    }

    // 8. Beanå°±ç»ªï¼Œå¯ä»¥ä½¿ç”¨

    // 9. å®¹å™¨å…³é—­æ—¶é”€æ¯Bean
    @PreDestroy
    public void preDestroy() {
        System.out.println("9. @PreDestroyé”€æ¯æ–¹æ³•");
    }

    @Override
    public void destroy() {
        System.out.println("10. DisposableBean.destroy");
    }
}
</code></pre>

<h3>Beançš„ä½œç”¨åŸŸ</h3>

<pre class="language-java" data-lang="java"><code class="language-java">// Singletonï¼ˆé»˜è®¤ï¼‰ï¼šå•ä¾‹ï¼Œæ•´ä¸ªå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹
@Service
@Scope("singleton")
public class SingletonBean {
    // å®ç°ä»£ç 
}

// Prototypeï¼šåŸå‹ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºæ–°å®ä¾‹
@Service
@Scope("prototype")
public class PrototypeBean {
    // å®ç°ä»£ç 
}

// Requestï¼šWebåº”ç”¨ä¸­ï¼Œæ¯ä¸ªHTTPè¯·æ±‚ä¸€ä¸ªå®ä¾‹
@Service
@Scope(value = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)
public class RequestBean {
    // å®ç°ä»£ç 
}

// Sessionï¼šWebåº”ç”¨ä¸­ï¼Œæ¯ä¸ªHTTP Sessionä¸€ä¸ªå®ä¾‹
@Service
@Scope(value = WebApplicationContext.SCOPE_SESSION, proxyMode = ScopedProxyMode.TARGET_CLASS)
public class SessionBean {
    // å®ç°ä»£ç 
}
</code></pre>

<h2>ç¬¬äºŒéƒ¨åˆ†ï¼šAOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰</h2>

<h3>ä»€ä¹ˆæ˜¯AOPï¼Ÿ</h3>

AOPï¼ˆAspect-Oriented Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨ç­‰ï¼‰ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œæé«˜ä»£ç çš„æ¨¡å—åŒ–ç¨‹åº¦ã€‚

<h4>AOPçš„æ ¸å¿ƒæ¦‚å¿µ</h4>

<pre class="language-java" data-lang="java"><code class="language-java">// 1. åˆ‡é¢ï¼ˆAspectï¼‰ï¼šæ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–
@Aspect
@Component
public class LoggingAspect {

    // 2. è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰ï¼šç¨‹åºæ‰§è¡Œçš„ç‰¹å®šç‚¹ï¼ˆå¦‚æ–¹æ³•è°ƒç”¨ï¼‰
    // 3. åˆ‡ç‚¹ï¼ˆPointcutï¼‰ï¼šåŒ¹é…è¿æ¥ç‚¹çš„è¡¨è¾¾å¼
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void serviceLayer() {}

    // 4. é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šåœ¨åˆ‡ç‚¹æ‰§è¡Œçš„ä»£ç 
    // å‰ç½®é€šçŸ¥ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œ
    @Before("serviceLayer()")
    public void logBefore(JoinPoint joinPoint) {
        System.out.println("æ‰§è¡Œæ–¹æ³•: " + joinPoint.getSignature().getName());
    }

    // åç½®é€šçŸ¥ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œåæ‰§è¡Œï¼ˆæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼‰
    @After("serviceLayer()")
    public void logAfter(JoinPoint joinPoint) {
        System.out.println("æ–¹æ³•æ‰§è¡Œå®Œæˆ: " + joinPoint.getSignature().getName());
    }

    // è¿”å›é€šçŸ¥ï¼šåœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸè¿”å›åæ‰§è¡Œ
    @AfterReturning(pointcut = "serviceLayer()", returning = "result")
    public void logAfterReturning(JoinPoint joinPoint, Object result) {
        System.out.println("æ–¹æ³•è¿”å›: " + result);
    }

    // å¼‚å¸¸é€šçŸ¥ï¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶æ‰§è¡Œ
    @AfterThrowing(pointcut = "serviceLayer()", throwing = "exception")
    public void logAfterThrowing(JoinPoint joinPoint, Throwable exception) {
        System.out.println("æ–¹æ³•å¼‚å¸¸: " + exception.getMessage());
    }

    // ç¯ç»•é€šçŸ¥ï¼šæœ€å¼ºå¤§çš„é€šçŸ¥ç±»å‹ï¼Œå¯ä»¥å®Œå…¨æ§åˆ¶æ–¹æ³•çš„æ‰§è¡Œ
    @Around("serviceLayer()")
    public Object logAround(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();

        System.out.println("å¼€å§‹æ‰§è¡Œ: " + joinPoint.getSignature().getName());

        try {
            Object result = joinPoint.proceed();
            long endTime = System.currentTimeMillis();
            System.out.println("æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: " + (endTime - startTime) + "ms");
            return result;
        } catch (Exception e) {
            System.out.println("æ‰§è¡Œå¼‚å¸¸: " + e.getMessage());
            throw e;
        }
    }
}
</code></pre>

<h3>åˆ‡ç‚¹è¡¨è¾¾å¼è¯¦è§£</h3>

<h4>executionè¡¨è¾¾å¼</h4>

<pre class="language-java" data-lang="java"><code class="language-java">// è¯­æ³•ï¼šexecution(ä¿®é¥°ç¬¦ è¿”å›å€¼ç±»å‹ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°) å¼‚å¸¸)

// 1. åŒ¹é…æ‰€æœ‰publicæ–¹æ³•
@Pointcut("execution(public * *(..))")
public void anyPublicMethod() {}

// 2. åŒ¹é…com.example.serviceåŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•
@Pointcut("execution(* com.example.service.*.*(..))")
public void servicePackage() {}

// 3. åŒ¹é…com.example.serviceåŒ…åŠå…¶å­åŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•
@Pointcut("execution(* com.example.service..*.*(..))")
public void serviceAndSubPackage() {}

// 4. åŒ¹é…æ‰€æœ‰ä»¥saveå¼€å¤´çš„æ–¹æ³•
@Pointcut("execution(* save*(..))")
public void saveMethods() {}

// 5. åŒ¹é…UserServiceæ¥å£çš„æ‰€æœ‰æ–¹æ³•
@Pointcut("execution(* com.example.service.UserService.*(..))")
public void userServiceMethods() {}

// 6. åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºStringçš„æ–¹æ³•
@Pointcut("execution(* *(String, ..))")
public void firstParamString() {}

// 7. åŒ¹é…è¿”å›å€¼ä¸ºvoidçš„æ–¹æ³•
@Pointcut("execution(void com.example.service.*.*(..))")
public void voidMethods() {}
</code></pre>

<h4>å…¶ä»–è¡¨è¾¾å¼ç±»å‹</h4>

<pre class="language-java" data-lang="java"><code class="language-java">@Aspect
@Component
public class VariousPointcuts {

    // withinï¼šé™å®šç±»èŒƒå›´
    @Pointcut("within(com.example.service.*)")
    public void withinServicePackage() {}

    // thisï¼šé™å®šä»£ç†å¯¹è±¡ç±»å‹
    @Pointcut("this(com.example.service.UserService)")
    public void thisUserService() {}

    // targetï¼šé™å®šç›®æ ‡å¯¹è±¡ç±»å‹
    @Pointcut("target(com.example.service.UserService)")
    public void targetUserService() {}

    // argsï¼šé™å®šå‚æ•°ç±»å‹
    @Pointcut("args(com.example.model.User)")
    public void userArgument() {}

    // @annotationï¼šé™å®šæ³¨è§£
    @Pointcut("@annotation(com.example.annotation.Loggable)")
    public void loggableMethod() {}

    // @withinï¼šé™å®šç±»ä¸Šçš„æ³¨è§£
    @Pointcut("@within(com.example.annotation.Service)")
    public void serviceClass() {}

    // @targetï¼šé™å®šç›®æ ‡å¯¹è±¡ä¸Šçš„æ³¨è§£
    @Pointcut("@target(com.example.annotation.RestController)")
    public void restControllerClass() {}

    // beanï¼šé™å®šBeanåç§°
    @Pointcut("bean(userService)")
    public void userServiceBean() {}

    // ç»„åˆè¡¨è¾¾å¼
    @Pointcut("servicePackage() &amp;&amp; !voidMethods()")
    public void serviceAndNotVoid() {}

    @Pointcut("servicePackage() || controllerMethods()")
    public void serviceOrController() {}
}
</code></pre>

<h3>AOPçš„å®é™…åº”ç”¨åœºæ™¯</h3>

<h4>1. æ—¥å¿—è®°å½•</h4>

<pre class="language-java" data-lang="java"><code class="language-java">@Aspect
@Component
@Slf4j
public class LoggingAspect {

    @Around("@annotation(com.example.annotation.Loggable)")
    public Object logMethodExecution(ProceedingJoinPoint joinPoint) throws Throwable {
        String className = joinPoint.getTarget().getClass().getSimpleName();
        String methodName = joinPoint.getSignature().getName();
        Object[] args = joinPoint.getArgs();

        log.info("{}.{}() - å¼€å§‹æ‰§è¡Œï¼Œå‚æ•°: {}", className, methodName, Arrays.toString(args));

        long startTime = System.currentTimeMillis();
        Object result;
        try {
            result = joinPoint.proceed();
            long endTime = System.currentTimeMillis();
            log.info("{}.{}() - æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›å€¼: {}, è€—æ—¶: {}ms",
                    className, methodName, result, endTime - startTime);
            return result;
        } catch (Exception e) {
            log.error("{}.{}() - æ‰§è¡Œå¼‚å¸¸: {}", className, methodName, e.getMessage(), e);
            throw e;
        }
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Loggable {
    String value() default "";
}

// åœ¨æ–¹æ³•ä¸Šä½¿ç”¨æ³¨è§£
@Service
public class UserService {
    @Loggable("ç”¨æˆ·æ³¨å†Œ")
    public void registerUser(User user) {
        // ä¸šåŠ¡é€»è¾‘
    }
}
</code></pre>

<h4>2. æ€§èƒ½ç›‘æ§</h4>

<pre class="language-java" data-lang="java"><code class="language-java">@Aspect
@Component
public class PerformanceAspect {

    private final Map&lt;String, Long&gt; methodStats = new ConcurrentHashMap&lt;&gt;();

    @Around("execution(* com.example.service.*.*(..))")
    public Object monitorPerformance(ProceedingJoinPoint joinPoint) throws Throwable {
        String methodName = joinPoint.getSignature().toShortString();
        long startTime = System.currentTimeMillis();

        try {
            return joinPoint.proceed();
        } finally {
            long duration = System.currentTimeMillis() - startTime;
            methodStats.merge(methodName, duration, Long::sum);
            if (duration &gt; 1000) {
                System.out.println("è­¦å‘Š: " + methodName + " æ‰§è¡Œæ—¶é—´è¿‡é•¿: " + duration + "ms");
            }
        }
    }

    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿè¾“å‡ºä¸€æ¬¡ç»Ÿè®¡ä¿¡æ¯
    public void printStatistics() {
        methodStats.forEach((method, totalTime) -&gt;
            System.out.println(method + ": æ€»è€—æ—¶ " + totalTime + "ms"));
    }
}
</code></pre>

<h4>3. ç¼“å­˜</h4>

<pre class="language-java" data-lang="java"><code class="language-java">@Aspect
@Component
public class CacheAspect {

    private final Map&lt;String, Object&gt; cache = new ConcurrentHashMap&lt;&gt;();

    @Around("@annotation(cacheable)")
    public Object cacheResult(ProceedingJoinPoint joinPoint, Cacheable cacheable) throws Throwable {
        String cacheKey = generateKey(joinPoint, cacheable);

        Object cachedResult = cache.get(cacheKey);
        if (cachedResult != null) {
            System.out.println("ä»ç¼“å­˜ä¸­è·å–: " + cacheKey);
            return cachedResult;
        }

        Object result = joinPoint.proceed();
        cache.put(cacheKey, result);
        System.out.println("å­˜å…¥ç¼“å­˜: " + cacheKey);

        return result;
    }

    private String generateKey(ProceedingJoinPoint joinPoint, Cacheable cacheable) {
        StringBuilder keyBuilder = new StringBuilder();
        keyBuilder.append(joinPoint.getSignature().toShortString());
        for (Object arg : joinPoint.getArgs()) {
            keyBuilder.append(":").append(arg);
        }
        return keyBuilder.toString();
    }
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Cacheable {
    String key() default "";
}

// ä½¿ç”¨
@Service
public class UserService {
    @Cacheable
    public User findById(Long id) {
        // ä»æ•°æ®åº“æŸ¥è¯¢
        return userRepository.findById(id);
    }
}
</code></pre>

<h4>4. äº‹åŠ¡ç®¡ç†</h4>

<pre class="language-java" data-lang="java"><code class="language-java">@Aspect
@Component
public class TransactionAspect {

    @Around("@annotation(transactional)")
    public Object manageTransaction(ProceedingJoinPoint joinPoint, Transactional transactional) throws Throwable {
        Connection connection = null;
        try {
            connection = getDatabaseConnection();
            connection.setAutoCommit(false);

            Object result = joinPoint.proceed();

            connection.commit();
            return result;
        } catch (Exception e) {
            if (connection != null) {
                connection.rollback();
            }
            throw e;
        } finally {
            if (connection != null) {
                connection.close();
            }
        }
    }
}

// ä½¿ç”¨
@Service
public class UserService {
    @Transactional
    public void transferMoney(Long fromId, Long toId, BigDecimal amount) {
        // è½¬è´¦é€»è¾‘
    }
}
</code></pre>

<h3>Spring AOPçš„å®ç°åŸç†</h3>

Spring AOPä¸»è¦é€šè¿‡åŠ¨æ€ä»£ç†å®ç°ï¼š

<pre class="language-java" data-lang="java"><code class="language-java">// JDKåŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰
public interface UserService {
    void saveUser(User user);
}

public class UserServiceImpl implements UserService {
    public void saveUser(User user) {
        System.out.println("ä¿å­˜ç”¨æˆ·: " + user.getName());
    }
}

// ä»£ç†å®ç°
public class UserServiceProxy implements InvocationHandler {

    private Object target;

    public UserServiceProxy(Object target) {
        this.target = target;
    }

    public Object getProxy() {
        return Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            target.getClass().getInterfaces(),
            this
        );
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println("å‰ç½®é€šçŸ¥: " + method.getName());
        Object result = method.invoke(target, args);
        System.out.println("åç½®é€šçŸ¥: " + method.getName());
        return result;
    }
}

// CGLIBä»£ç†ï¼ˆåŸºäºç±»ï¼‰
public class UserServiceCglibProxy implements MethodInterceptor {

    private Object target;

    public UserServiceCglibProxy(Object target) {
        this.target = target;
    }

    public Object getProxy() {
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(target.getClass());
        enhancer.setCallback(this);
        return enhancer.create();
    }

    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        System.out.println("å‰ç½®é€šçŸ¥: " + method.getName());
        Object result = proxy.invoke(target, args);
        System.out.println("åç½®é€šçŸ¥: " + method.getName());
        return result;
    }
}
</code></pre>

<h3>IOCä¸AOPçš„ç»¼åˆåº”ç”¨</h3>

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç»¼åˆç¤ºä¾‹ï¼š

<pre class="language-java" data-lang="java"><code class="language-java">// 1. å®šä¹‰å®ä½“ç±»
@Data
public class User {
    private Long id;
    private String username;
    private String email;
}

// 2. å®šä¹‰DAOæ¥å£å’Œå®ç°
@Repository
public interface UserDao {
    User save(User user);
    User findById(Long id);
    void delete(Long id);
}

@Repository
public class UserDaoImpl implements UserDao {
    @Override
    public User save(User user) {
        // æ•°æ®åº“ä¿å­˜é€»è¾‘
        System.out.println("ä¿å­˜ç”¨æˆ·åˆ°æ•°æ®åº“");
        return user;
    }

    @Override
    public User findById(Long id) {
        // æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
        System.out.println("ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·");
        return new User();
    }

    @Override
    public void delete(Long id) {
        // æ•°æ®åº“åˆ é™¤é€»è¾‘
        System.out.println("ä»æ•°æ®åº“åˆ é™¤ç”¨æˆ·");
    }
}

// 3. å®šä¹‰Serviceå±‚
@Service
public class UserService {
    private final UserDao userDao;
    private final EmailService emailService;

    public UserService(UserDao userDao, EmailService emailService) {
        this.userDao = userDao;
        this.emailService = emailService;
    }

    @Loggable("ç”¨æˆ·æ³¨å†Œ")
    @Transactional
    public void registerUser(User user) {
        userDao.save(user);
        emailService.sendWelcomeEmail(user.getEmail());
    }

    @Cacheable
    public User getUserById(Long id) {
        return userDao.findById(id);
    }

    @Transactional
    public void deleteUser(Long id) {
        userDao.delete(id);
    }
}

// 4. å®šä¹‰åˆ‡é¢
@Aspect
@Component
public class ApplicationAspect {

    // æ—¥å¿—åˆ‡é¢
    @Around("@annotation(com.example.annotation.Loggable)")
    public Object logAround(ProceedingJoinPoint joinPoint) throws Throwable {
        String methodName = joinPoint.getSignature().getName();
        System.out.println("æ–¹æ³•å¼€å§‹æ‰§è¡Œ: " + methodName);

        try {
            Object result = joinPoint.proceed();
            System.out.println("æ–¹æ³•æ‰§è¡ŒæˆåŠŸ: " + methodName);
            return result;
        } catch (Exception e) {
            System.out.println("æ–¹æ³•æ‰§è¡Œå¼‚å¸¸: " + methodName + ", " + e.getMessage());
            throw e;
        }
    }

    // æ€§èƒ½ç›‘æ§åˆ‡é¢
    @Around("execution(* com.example.service.*.*(..))")
    public Object monitorPerformance(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();
        Object result = joinPoint.proceed();
        long duration = System.currentTimeMillis() - startTime;

        if (duration &gt; 100) {
            System.out.println("æ€§èƒ½è­¦å‘Š: " + joinPoint.getSignature().toShortString()
                    + " æ‰§è¡Œæ—¶é—´: " + duration + "ms");
        }
        return result;
    }
}

// 5. é…ç½®ç±»
@Configuration
@ComponentScan("com.example")
@EnableAspectJAutoProxy
public class AppConfig {
}

// 6. å¯åŠ¨ç±»
public class Application {
    public static void main(String[] args) {
        ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);

        UserService userService = context.getBean(UserService.class);

        User user = new User();
        user.setUsername("testuser");
        user.setEmail("test@example.com");

        userService.registerUser(user);
        User foundUser = userService.getUserById(1L);
    }
}
</code></pre>

<h2>æ€»ç»“</h2>

<h3>IOCçš„ä¼˜åŠ¿</h3>

<ol><li><strong>é™ä½è€¦åˆ</strong>ï¼šé€šè¿‡ä¾èµ–æ³¨å…¥é™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆåº¦</li></ol>
<ol><li><strong>ä¾¿äºæµ‹è¯•</strong>ï¼šå¯ä»¥è½»æ¾mockä¾èµ–è¿›è¡Œå•å…ƒæµ‹è¯•</li></ol>
<ol><li><strong>é›†ä¸­ç®¡ç†</strong>ï¼šç»Ÿä¸€ç®¡ç†Beançš„ç”Ÿå‘½å‘¨æœŸå’Œé…ç½®</li></ol>
<ol><li><strong>æé«˜å¯ç»´æŠ¤æ€§</strong>ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤</li></ol>

<h3>AOPçš„ä¼˜åŠ¿</h3>

<ol><li><strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼šå°†æ¨ªåˆ‡å…³æ³¨ç‚¹ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»</li></ol>
<ol><li><strong>ä»£ç å¤ç”¨</strong>ï¼šé¿å…é‡å¤çš„æ¨ªåˆ‡é€»è¾‘ä»£ç </li></ol>
<ol><li><strong>çµæ´»é…ç½®</strong>ï¼šé€šè¿‡åˆ‡ç‚¹è¡¨è¾¾å¼çµæ´»åœ°å®šä¹‰åˆ‡é¢</li></ol>
<ol><li><strong>å¢å¼ºåŠŸèƒ½</strong>ï¼šåœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹å¢å¼ºåŠŸèƒ½</li></ol>

<h3>æœ€ä½³å®è·µ</h3>

<ol><li><strong>ä¼˜å…ˆä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥</strong></li></ol>
<ol><li><strong>åˆç†ä½¿ç”¨æ³¨è§£ï¼Œé¿å…è¿‡åº¦ä½¿ç”¨</strong></li></ol>
<ol><li><strong>AOPåˆ‡é¢ä¿æŒç®€å•ï¼Œé¿å…å¤æ‚é€»è¾‘</strong></li></ol>
<ol><li><strong>åˆç†å®šä¹‰Beançš„ä½œç”¨åŸŸ</strong></li></ol>
<ol><li><strong>æ³¨æ„å¾ªç¯ä¾èµ–é—®é¢˜</strong></li></ol>
<ol><li><strong>æ€§èƒ½æ•æ„Ÿçš„ä»£ç æ…ç”¨AOP</strong></li></ol>

<h3>å­¦ä¹ å»ºè®®</h3>

<ol><li>ä»ç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œé€æ­¥ç†è§£IOCå’ŒAOPçš„æ¦‚å¿µ</li></ol>
<ol><li>é˜…è¯»Springæºç ï¼Œäº†è§£åº•å±‚å®ç°åŸç†</li></ol>
<ol><li>åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨ï¼Œç§¯ç´¯ç»éªŒ</li></ol>
<ol><li>å­¦ä¹ è®¾è®¡æ¨¡å¼ï¼Œç†è§£IOCå’ŒAOPçš„è®¾è®¡æ€æƒ³</li></ol>

<h2>å‚è€ƒèµ„æº</h2>

<ul><ol><li>Spring Frameworkå®˜æ–¹æ–‡æ¡£</li></ol></ul>
<ul><ol><li>ã€ŠSpringæºç æ·±åº¦è§£æã€‹</li></ol></ul>
<ul><ol><li>ã€ŠSpringå®æˆ˜ã€‹</li></ol></ul>
<ul><ol><li>ã€ŠEffective Javaã€‹</li></ol></ul>
</p>
        </div>
      </article>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2026 zhizhi2213. All rights reserved.</p>
    </div>
  </footer>

  <script src="/static/assets/script.js"></script>
</body>
</html>
